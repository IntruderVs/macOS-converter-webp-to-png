# WebP to PNG Converter (Go)

Консольное приложение на Go для конвертации изображений из формата WebP в PNG.

## Требования

- Go 1.21 или выше

## Установка Go (если не установлен)

```bash
brew install go
```

## Сборка

```bash
go build -o webp-to-png main.go
```

Или для создания оптимизированного бинарника:

```bash
go build -ldflags="-s -w" -o webp-to-png main.go
```

## Использование

### Конвертация одного файла

```bash
./webp-to-png image.webp
```

В этом случае выходной файл будет создан с тем же именем, но с расширением `.png`.

### Конвертация с указанием выходного файла

```bash
./webp-to-png image.webp output.png
```

### Конвертация всех WebP файлов в директории

```bash
./webp-to-png ./images
```

В этом случае все PNG файлы будут созданы в той же директории.

### Конвертация директории с указанием выходной директории

```bash
./webp-to-png ./images ./converted
```

## Примеры

```bash
# Конвертировать один файл
./webp-to-png photo.webp

# Конвертировать с другим именем
./webp-to-png photo.webp result.png

# Конвертировать все WebP в текущей директории
./webp-to-png .

# Конвертировать все WebP из одной папки в другую
./webp-to-png ./webp_images ./png_images

# Использование с полным путем
./webp-to-png /path/to/image.webp /path/to/output.png
```

## Преимущества Go версии

- ✅ Компилируется в один исполняемый файл (без зависимостей)
- ✅ Быстрая работа
- ✅ Не требует установки дополнительных библиотек
- ✅ Легко интегрируется в контекстное меню macOS
- ✅ Кроссплатформенность (можно скомпилировать для разных ОС)

## Зависимости

Проект использует стандартную библиотеку Go и пакет `golang.org/x/image/webp` для работы с WebP форматом.

Установка зависимостей:

```bash
go mod download
```

## Структура проекта

```
converter/
├── main.go          # Основной файл программы
├── go.mod           # Go модуль
├── go.sum           # Checksums зависимостей (генерируется автоматически)
└── README_GO.md     # Этот файл
```

## Кроссплатформенная сборка

### macOS

```bash
GOOS=darwin GOARCH=amd64 go build -o webp-to-png-mac main.go
```

### Linux

```bash
GOOS=linux GOARCH=amd64 go build -o webp-to-png-linux main.go
```

### Windows

```bash
GOOS=windows GOARCH=amd64 go build -o webp-to-png.exe main.go
```

## Ручная интеграция с контекстным меню macOS

Если вы предпочитаете настроить вручную, после сборки бинарника можно добавить его в контекстное меню Finder для быстрой конвертации WebP файлов.

### Использование Automator (рекомендуется)

1. **Откройте Automator** (приложение → Automator)

2. **Создайте новый Quick Action:**
   - File → New → Quick Action (или Service)

3. **Настройте Quick Action:**
   - **Workflow receives current:** `files or folders`
   - **in:** `Finder`

4. **Добавьте действие "Run Shell Script":**
   - Найдите "Run Shell Script" в списке действий слева
   - Перетащите его в рабочую область справа

5. **Настройте скрипт:**
   - Установите "Pass input:" в `as arguments`
   - Замените содержимое скрипта на:

```bash
# Укажите абсолютный путь к вашему бинарнику (замените на свой путь)
WEBP_TO_PNG="/path/to/your/webp-to-png"

# Создаем подпапку с текущей датой для конвертированных файлов
OUTPUT_DIR="$(date +%Y-%m-%d)_to-png"

# Обрабатываем каждый выбранный файл
for file in "$@"
do
    if [[ "$file" =~ \.[Ww][Ee][Bb][Pp]$ ]]; then
        # Определяем директорию файла и имя файла
        FILE_DIR="$(dirname "$file")"
        FILE_NAME="$(basename "$file")"
        
        # Формируем имя выходного PNG файла (заменяем .webp на .png)
        PNG_NAME="${FILE_NAME%.*}.png"
        
        # Формируем путь к выходной директории и файлу
        OUTPUT_PATH="$FILE_DIR/$OUTPUT_DIR/$PNG_NAME"
        
        # Создаем подпапку, если её еще нет
        mkdir -p "$FILE_DIR/$OUTPUT_DIR"
        
        # Конвертируем файл в подпапку (передаем полный путь к выходному файлу)
        "$WEBP_TO_PNG" "$file" "$OUTPUT_PATH"
    fi
done

# Показываем уведомление о завершении
osascript -e 'display notification "Конвертация завершена" with title "WebP to PNG"'
```

   **Примечание:** Замените `/path/to/your/webp-to-png` на реальный путь к вашему бинарнику (например, `/Users/.../go/macOS-converter-webp-to-png/webp-to-png`)

6. **Сохраните Quick Action:**
   - File → Save (⌘S)
   - Назовите его, например: `Convert WebP to PNG`
   - Нажмите Save

7. **Готово!** Теперь в контекстном меню Finder для WebP файлов появится опция "Convert WebP to PNG"

### Использование

После настройки:

1. Выберите один или несколько WebP файлов в Finder
2. Правый клик (или Control+Click)
3. Выберите "Convert WebP to PNG" в контекстном меню (или Services подменю)
4. Конвертация выполнится автоматически, PNG файлы создадутся в подпапке с датой (например, `2026-01-11_to-png`)

### Примечания

- Убедитесь, что указан правильный абсолютный путь к бинарнику `webp-to-png`
- Если вы переместите бинарник, обновите путь в Quick Action
- Для работы с несколькими файлами одновременно, Quick Action обработает все выбранные файлы
- PNG файлы создаются в подпапке с форматом `YYYY-MM-DD_to-png` (например, `2026-01-11_to-png`)
- Подпапка создается автоматически в той же директории, где находятся исходные WebP файлы
- Если несколько файлов выбрано из разных директорий, для каждой директории будет создана своя подпапка

## Примечания

- Приложение автоматически создает необходимые директории для выходных файлов
- При конвертации директории обрабатываются только файлы с расширением `.webp` (регистронезависимо)
- Если выходной файл не указан, создается файл с тем же именем и расширением `.png`
- Поддерживается сохранение прозрачности (альфа-канал) при конвертации
